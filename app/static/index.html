<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì ì‹¬ ë©”ë‰´ ì¶”ì²œ</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    h1 { margin-bottom: 8px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; }
    button.primary { border-color: #111; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .chip { border:1px solid #ddd; border-radius:999px; padding:6px 10px; background:#f7f7f7; font-size:14px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .big { font-size: 28px; font-weight: 700; margin: 10px 0 0; }
    .muted { color: #666; font-size: 14px; }
    pre { background: #111; color: #eee; padding: 12px; border-radius: 10px; overflow: auto; }
    input { padding: 10px 12px; border-radius: 10px; border: 1px solid #ccc; width: 180px; }
  </style>
</head>
<body>
  <h1>ğŸ± ì ì‹¬ ë©”ë‰´ ì¶”ì²œ</h1>
  <p class="muted">ë²„íŠ¼ì„ ëˆŒëŸ¬ ëœë¤ ì¶”ì²œ ë˜ëŠ” ë£°ë › ì¶”ì²œì„ ì‹¤í–‰í•´ë³´ì„¸ìš”.</p>

  <div class="card">
    <div class="row">
      <button class="primary" id="btnRandom">ğŸ² ëœë¤ ì¶”ì²œ</button>
      <button id="btnSpin">ğŸ¡ ë£°ë › ëŒë¦¬ê¸°</button>
      <input id="seed" placeholder="seed (ì˜µì…˜)" />
    </div>
    <div class="big" id="result">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
    <p class="muted" id="meta"></p>
  </div>

  <div class="card">
    <div class="row">
      <button id="btnMenus">ğŸ“‹ ë©”ë‰´ ëª©ë¡ ë³´ê¸°</button>
    </div>
    <pre id="menuList" class="chips muted">ì•„ì§ ë©”ë‰´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</pre>
  </div>

  <p class="muted">API ë¬¸ì„œ: <a href="/docs" target="_blank">/docs</a></p>

<script>
  const $ = (id) => document.getElementById(id);

  async function getJSON(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
    return res.json();
  }

  $("btnRandom").onclick = async () => {
    $("meta").textContent = "ìš”ì²­ ì¤‘...";
    const data = await getJSON("/api/random");
    $("result").textContent = data.menu;
    $("meta").textContent = "ëœë¤ ì¶”ì²œ ì™„ë£Œ";
  };

  $("btnSpin").onclick = async () => {
    $("meta").textContent = "ë£°ë › ë„ëŠ” ì¤‘...";
    const seed = $("seed").value.trim();
    const qs = new URLSearchParams();
    if (seed) qs.set("seed", seed);
    qs.set("ticks", "18");
    const data = await getJSON("/api/spin?" + qs.toString());

    // ê°„ë‹¨í•œ ë£°ë › ì—°ì¶œ: ticksë¥¼ ë¹ ë¥´ê²Œ í‘œì‹œ
    let i = 0;
    const ticks = data.ticks || [];
    const timer = setInterval(() => {
      $("result").textContent = ticks[i] ?? data.result;
      i++;
      if (i >= ticks.length) {
        clearInterval(timer);
        $("result").textContent = data.result;
        $("meta").textContent = `ë£°ë › ì™„ë£Œ (ticks=${ticks.length}, duration_ms=${data.duration_ms})`;
      }
    }, 80);
  };

  $("btnMenus").onclick = async () => {
  $("meta").textContent = "ë©”ë‰´ ëª©ë¡ ê°€ì ¸ì˜¤ëŠ” ì¤‘...";
  const data = await getJSON("/api/menus");

  const box = $("menuList");
  box.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

  (data.menus || []).forEach((m) => {
    const span = document.createElement("span");
    span.className = "chip";
    span.textContent = m;
    box.appendChild(span);
  });

  $("meta").textContent = `ë©”ë‰´ ${data.count}ê°œ ë¡œë“œë¨`;
};

</script>
</body>
</html>

